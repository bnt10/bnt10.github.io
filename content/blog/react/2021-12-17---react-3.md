---
title: react 개발일지-(3)
date: "2021-12-17"
template: "post"
draft: true
slug: "react 개발일지-3"
category: 
  "nextjs"
tags:
  - "react"
  - "nextjs"
  - "redux"
description: "nextjs , typescript, redux , redux-toolkit 적용(1)"
socialImage: "/media/gatsby_icon.png"
---


#### 설치
```javascript
npm install @reduxjs/toolkit react-redux
npm install @types/react-redux
```

#### 구성
Nextjs, Typescript, ReduxToolkit를 조합하여
Redux를 구성하기
이번에는 ReduxToolkit을 기준으로 하여 구성해보기로 한다.

#### rootReducer 작성
reducer를 통합할 rootReducer 작성
```javascript
// /src/store/modules/index.ts
import { combineReducers, ThunkAction, Action } from '@reduxjs/toolkit';
import counterSlice from "./counter/counterSlice";

//configureStore 넘겨줄 rootReucer 작성
const rootReducer = combineReducers({
    counterSlice
})

//사용할 타입 정의
export type RootState = ReturnType<typeof rootReducer>;
export type AppThunk<ReturnType = void> = ThunkAction<
    ReturnType,
    RootState,
    unknown,
    Action<string>
>;
export default rootReducer;


```
#### Hooks 작성
useAppDispatch , useAppSelector Hook 작성  
작성하는 이유는 useSelector의 타입을 예를 들어서 useSelector(state:RootState)를
반복적으로 작성하는 것을 피하기 위해서
useAppDispatch를 작성하는 이유도 마찬가지다

```javascript
// /src/hooks/index.ts
import {
    TypedUseSelectorHook,
    useDispatch,
    useSelector,
} from 'react-redux';
import { RootState } from 'src/store/modules';
import type {
    AppDispatch,
} from 'src/store';


export const useAppDispatch = () => useDispatch<AppDispatch>()
export const useAppSelector: TypedUseSelectorHook<RootState> = useSelector;

```

#### configureStore 작성
redux의 설정을 관리할 configureStore를 작성한다
```javascript
// src/store/index.ts
import {
    configureStore,
} from '@reduxjs/toolkit';

import rootReducer from './modules';
import logger from 'redux-logger';
import { Context, createWrapper } from "next-redux-wrapper";

//redux store config
const store = configureStore({
    reducer: rootReducer,
    middleware: (getDefaultMiddleware) => getDefaultMiddleware().concat(logger),
});

//dispatch type
export type AppDispatch = typeof store.dispatch;

//next-js redux wrapper 작성
const wrapper = createWrapper((context: Context) => store, { debug: process.env.NODE_ENV !== 'production', });

export default wrapper;
```

#### 리듀서 작성하기 (counterSlice.ts)
리듀서의 작동을 확인 하기 위한 간단한 카운터를 작성해본다.
```javascript
import {
    createSlice,
    PayloadAction,
} from '@reduxjs/toolkit';
import { RootState } from '..';

//counterState 타입 정의
export type CounterState = {
    value: number;
};

const initialState: CounterState = {
    value: 0,
};

export const counterSlice = createSlice({
    //생성된 액션타입의 네임스페이스로 사용된다.
    name: 'counter',
    //초기 State값으로 전달된 initalState에서 CounterState타입을 유추한다.
    initialState,
    reducers: {
        //리덕스의 actionCreator
        increment: (state: CounterState) => {
            state.value++;
        },
        decrement: (state: CounterState) => {
            state.value--;
        },
        //payload 추가하는 경우 타입지정 예시
        incrementByAmount: (state: CounterState, action: PayloadAction<number>) => {
            state.value += action.payload;
        },
    },
});
// 작성한 타입을 export
export const {
    increment,
    decrement,
    incrementByAmount,
} = counterSlice.actions;

// selector 작성 
export const selectCount = (state: RootState) => state.counterSlice.value;

const counterReducer = counterSlice.reducer;
export default counterReducer;
```

#### _app.ts에 redux store 적용
```javascript
// /src/pages/_app.ts

import { AppProps } from 'next/app'
import { ThemeProvider } from 'styled-components';
import { theme } from 'src/styles/theme';
import GlobalStyle from 'src/styles/global-styles';
import wrapper from '../store';

const MyApp = ({ Component, pageProps }: AppProps) => {
  return (

    <ThemeProvider theme={theme}>
      <GlobalStyle />
      <Component {...pageProps} />
    </ThemeProvider>

  )
}
//리덕스로 감싸기
export default wrapper.withRedux(MyApp)
```

#### 동작확인 component 작성
```javascript
// /src/pages/index.ts
import { useState } from 'react';
import {
    useAppDispatch,
    useAppSelector,
} from 'src/hooks';
import {
    decrement,
    increment,
    incrementByAmount,
    selectCount,
} from 'src/store/modules/counter/counterSlice';


const IndexPage: React.FC = () => {
    const dispatch = useAppDispatch();
    const count = useAppSelector(selectCount);
    const [incrementAmount, setIncrementAmount] = useState<number>(0);

    return (
        <>
            <h1>Redux Counter</h1>
            <h2>
                숫자 : {count}
            </h2>
            <div>
                <input
                    value={incrementAmount}
                    onChange={(e) => setIncrementAmount(Number(e.target.value))}
                    type="number"
                />
                <button
                    onClick={() => dispatch(incrementByAmount(Number(incrementAmount)))}
                >
                    입력값으로 +
                </button>
            </div>
            <div>
                <button onClick={() => dispatch(decrement())}>-1</button>
                <button onClick={() => dispatch(increment())}>+1</button>
            </div>
        </>
    );
};

export default IndexPage;
```